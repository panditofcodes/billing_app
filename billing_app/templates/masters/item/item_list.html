{% extends 'base.html' %}
{% block content %}

<div class="container-fluid mt-3">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary mb-0">
      <i class="bi bi-box-seam me-2"></i> Item Master
    </h2>
    <a href="{% url 'item_create' %}" class="btn btn-success px-3 shadow-sm">
      <i class="bi bi-plus-lg"></i> Add Item
    </a>
  </div>

  <!-- Card -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <div>
        <i class="bi bi-list-ul text-secondary me-2"></i>
        <strong>Item List</strong>
      </div>
      <span class="badge bg-primary-subtle text-primary">
        Total: {{ items|length }}
      </span>
    </div>

    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-primary text-center">
          <tr>
            <th style="width: 35%">Item Name</th>
            <th style="width: 15%">HSN Code</th>
            <th style="width: 20%">Price (₹)</th>
            <th style="width: 15%">GST (%)</th>
            <th style="width: 15%">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr class="text-center">
            <td class="text-start">
              <a href="{% url 'item_detail' item.id %}" class="text-decoration-none text-dark fw-semibold">
                <i class="bi bi-tag text-secondary me-1"></i> {{ item.name }}
              </a>
            </td>
            <td>{{ item.hsn_code|default:"-" }}</td>
            <td>₹{{ item.price|floatformat:2 }}</td>
            <td>{{ item.gst_rate|floatformat:2 }}</td>
            <td>
              <div class="d-flex justify-content-center gap-2">
                <a href="{% url 'item_edit' item.id %}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-pencil-square"></i>
                </a>
                <!-- Delete button triggers modal -->
                <button
                  class="btn btn-outline-danger btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmDeleteModal"
                  data-item-id="{{ item.id }}"
                  data-item-name="{{ item.name }}"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted py-4">
              <i class="bi bi-inbox fs-4 d-block mb-2"></i>
              No items found. Click "Add Item" to create one.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Bootstrap Delete Confirmation Modal -->
<div
  class="modal fade"
  id="confirmDeleteModal"
  tabindex="-1"
  aria-labelledby="confirmDeleteModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="confirmDeleteModalLabel">
          <i class="bi bi-exclamation-triangle-fill me-2"></i> Confirm Delete
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete
        <strong id="itemName"></strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <a id="confirmDeleteBtn" href="#" class="btn btn-danger">
          <i class="bi bi-trash"></i> Delete
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Script to set dynamic delete URL -->
<script>
  const confirmDeleteModal = document.getElementById("confirmDeleteModal");
  confirmDeleteModal.addEventListener("show.bs.modal", function (event) {
    const button = event.relatedTarget;
    const itemId = button.getAttribute("data-item-id");
    const itemName = button.getAttribute("data-item-name");
    const deleteUrl = `{% url 'item_delete' 0 %}`.replace("0", itemId);
    document.getElementById("itemName").textContent = itemName;
    document.getElementById("confirmDeleteBtn").setAttribute("href", deleteUrl);
  });
</script>

{% endblock %}
